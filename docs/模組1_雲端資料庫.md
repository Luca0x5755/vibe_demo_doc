# ğŸ“¦ æ¨¡çµ„1: é›²ç«¯è³‡æ–™åº« Supabase

## 1ï¸âƒ£ ç¬¬ä¸€æ€§åŸç†æ‹†è§£

**æ ¸å¿ƒçŸ¥è­˜é»ï¼šè³‡æ–™å»ºæ¨¡ (Data Modeling)**

```
æœ€æ ¹æœ¬çš„å•é¡Œï¼š
ã€Œç¾å¯¦ä¸–ç•Œçš„æ±è¥¿ï¼Œæ€éº¼å­˜é€²é›»è…¦ï¼Ÿã€

ç”Ÿæ´»é¡æ¯”ï¼š
â”œâ”€ åœ–æ›¸é¤¨æ›¸æ¶ï¼šæ›¸åˆ†é¡æ“ºæ”¾â†’è³‡æ–™è¡¨åˆ†é¡
â”œâ”€ æ›¸çš„å€Ÿé–±å¡ï¼šè¨˜éŒ„èª°å€Ÿäº†ä»€éº¼â†’é—œè¯è³‡æ–™
â””â”€ æ›¸ç›®ç´¢å¼•ï¼šå¿«é€Ÿæ‰¾æ›¸â†’è³‡æ–™åº«ç´¢å¼•

è»Ÿé«”ä¸­çš„å¯¦ç¾ï¼š
å¯¦é«”(Entity) + å±¬æ€§(Attribute) + é—œä¿‚(Relationship) = è³‡æ–™æ¨¡å‹
```

**æ‹†è§£æˆ3å€‹å­å•é¡Œï¼š**
1. **å¯¦é«”è­˜åˆ¥**ï¼šã€Œç³»çµ±è¦å­˜å“ªäº›ã€æ±è¥¿ã€ï¼Ÿã€
2. **å±¬æ€§å®šç¾©**ï¼šã€Œæ¯å€‹ã€æ±è¥¿ã€æœ‰å“ªäº›ç‰¹å¾µï¼Ÿã€
3. **é—œä¿‚å»ºç«‹**ï¼šã€Œã€æ±è¥¿ã€ä¹‹é–“å¦‚ä½•é€£çµï¼Ÿã€

---

## 2ï¸âƒ£ æ¨¡çµ„è¨­è¨ˆ

### è¨­è¨ˆç›®æ¨™
å»ºç«‹å®Œæ•´çš„è³‡æ–™åº«çµæ§‹ï¼Œç¢ºä¿è³‡æ–™å®Œæ•´æ€§èˆ‡æŸ¥è©¢æ•ˆç‡ã€‚

### ER åœ–ï¼ˆå¯¦é«”é—œä¿‚åœ–ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä½¿ç”¨è€…     â”‚         â”‚    è¨‚å–®      â”‚         â”‚    å•†å“      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚1       âˆâ”‚ id (PK)      â”‚        âˆâ”‚ id (PK)      â”‚
â”‚ username     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ user_id (FK) â”‚         â”‚ name         â”‚
â”‚ email        â”‚         â”‚ order_date   â”‚         â”‚ price        â”‚
â”‚ role         â”‚         â”‚ status       â”‚         â”‚ stock        â”‚
â”‚ created_at   â”‚         â”‚ total_amount â”‚         â”‚ category     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                        â”‚
                                â”‚ âˆ                     1â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                         â”‚  è¨‚å–®æ˜ç´°     â”‚              â”‚
                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
                         â”‚ id (PK)       â”‚              â”‚
                         â”‚ order_id (FK) â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ product_id (FK)
                         â”‚ quantity      â”‚
                         â”‚ price         â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™è¡¨è¨­è¨ˆ

| è³‡æ–™è¡¨ | ä¸»è¦æ¬„ä½ | èªªæ˜ |
|-------|---------|------|
| users | id, username, email, password_hash, role | ä½¿ç”¨è€…è³‡æ–™ |
| products | id, name, price, stock, category, is_active | å•†å“è³‡æ–™ |
| orders | id, order_number, user_id, status, total_amount | è¨‚å–®ä¸»è¡¨ |
| order_items | id, order_id, product_id, quantity, unit_price | è¨‚å–®æ˜ç´° |

### è³‡æ–™å®Œæ•´æ€§è¨­è¨ˆ

| è¨­è¨ˆåŸå‰‡ | ç¯„ä¾‹ | SQL å¯¦ç¾ |
|---------|------|----------|
| **éç©ºç´„æŸ** | email ä¸èƒ½ç‚ºç©º | `NOT NULL` |
| **å”¯ä¸€ç´„æŸ** | å¸³è™Ÿä¸èƒ½é‡è¤‡ | `UNIQUE` |
| **é è¨­å€¼** | è¨‚å–®ç‹€æ…‹é è¨­ã€Œå¾…è™•ç†ã€ | `DEFAULT 'pending'` |
| **å¤–éµç´„æŸ** | è¨‚å–®è¦å°æ‡‰åˆ°çœŸå¯¦ä½¿ç”¨è€… | `REFERENCES users(id)` |
| **æª¢æŸ¥ç´„æŸ** | æ•¸é‡ä¸èƒ½æ˜¯è² æ•¸ | `CHECK (quantity >= 0)` |

---

## 3ï¸âƒ£ AI å”ä½œé–‹ç™¼æç¤ºè©

### å®Œæ•´ Prompt ç¯„æœ¬

```markdown
# Supabase è³‡æ–™åº«çµæ§‹è¨­è¨ˆ (SQLAlchemy)

æˆ‘éœ€è¦ç‚ºè¨‚å–®ç®¡ç†ç³»çµ±å»ºç«‹è³‡æ–™åº«ï¼Œè«‹ä½¿ç”¨ **Python + SQLAlchemy** ä¾†å®šç¾©è³‡æ–™æ¨¡å‹ä¸¦åœ¨ Supabase (PostgreSQL) å»ºç«‹è³‡æ–™è¡¨ã€‚

## æŠ€è¡“éœ€æ±‚
- ä½¿ç”¨ `sqlalchemy` çš„ `declarative_base` æˆ– `orm.DeclarativeBase`ã€‚
- ä½¿ç”¨ `python-dotenv` è®€å– `.env` ä¸­çš„ `DATABASE_URL`ã€‚
- å¯«ä¸€å€‹ `create_tables.py` è…³æœ¬ï¼ŒåŸ·è¡Œæ™‚è‡ªå‹•å»ºç«‹æ‰€æœ‰è³‡æ–™è¡¨ (`Base.metadata.create_all`)ã€‚

## è³‡æ–™è¡¨æ¨¡å‹è¨­è¨ˆ

### 1. User (users)
- **æ¬„ä½**ï¼š
  - `id`: UUID, ä¸»éµ, é è¨­å€¼=uuid.uuid4
  - `username`: String, å”¯ä¸€, ä¸èƒ½ç‚ºç©º
  - `email`: String, å”¯ä¸€, ä¸èƒ½ç‚ºç©º
  - `password_hash`: String, ä¸èƒ½ç‚ºç©º
  - `role`: String, é è¨­å€¼='customer' (ä½¿ç”¨ Enum æˆ– Check Constraint é™åˆ¶: customer, admin, super_admin)
  - `created_at`: DateTime, é è¨­å€¼=func.now()
- **ç´¢å¼•**ï¼šusername, email

### 2. Product (products)
- **æ¬„ä½**ï¼š
  - `id`: UUID, ä¸»éµ
  - `name`: String, ä¸èƒ½ç‚ºç©º
  - `description`: Text, å¯ç‚ºç©º
  - `price`: Decimal(10, 2), ä¸èƒ½ç‚ºç©º
  - `stock`: Integer, é è¨­å€¼=0
  - `category`: String
  - `is_active`: Boolean, é è¨­å€¼=True
  - `created_at`: DateTime

### 3. Order (orders)
- **æ¬„ä½**ï¼š
  - `id`: UUID, ä¸»éµ
  - `order_number`: String, å”¯ä¸€ (ä¾‹å¦‚: ORD-20250101-001)
  - `user_id`: UUID, å¤–éµ('users.id')
  - `order_date`: DateTime, é è¨­å€¼=func.now()
  - `status`: String, é è¨­å€¼='pending' (é¸é …: pending, processing, shipped, completed, cancelled)
  - `total_amount`: Decimal(10, 2)
  - `delivery_address`: Text
  - `notes`: Text
- **é—œè¯**ï¼šå»ºç«‹èˆ‡ `User` çš„ relationship

### 4. OrderItem (order_items)
- **æ¬„ä½**ï¼š
  - `id`: UUID, ä¸»éµ
  - `order_id`: UUID, å¤–éµ('orders.id')
  - `product_id`: UUID, å¤–éµ('products.id')
  - `quantity`: Integer, ä¸èƒ½ç‚ºç©º
  - `unit_price`: Decimal(10, 2)
  - `subtotal`: Decimal(10, 2)
- **é—œè¯**ï¼šå»ºç«‹èˆ‡ `Order` å’Œ `Product` çš„ relationshipï¼Œä¸¦è¨­å®š `cascade="all, delete-orphan"` (ç•¶ Order åˆªé™¤æ™‚ï¼ŒItem ä¸€ä½µåˆªé™¤)

è«‹æä¾›å®Œæ•´çš„ `models.py` å’Œ `create_tables.py` ç¨‹å¼ç¢¼ï¼Œä»¥åŠ `.env.example` ç¯„æœ¬ã€‚
```

---

## 4ï¸âƒ£ æ‰‹å‹•åŠŸèƒ½æ¸¬è©¦èªªæ˜

### æ¸¬è©¦ç’°å¢ƒæº–å‚™
1. å®‰è£å¿…è¦å¥—ä»¶ï¼š
   ```bash
   pip install sqlalchemy psycopg2-binary python-dotenv
   ```
2. æº–å‚™ `.env` æª”æ¡ˆï¼Œå¡«å…¥ Supabase çš„ Connection Stringï¼š
   ```ini
   DATABASE_URL=postgresql://postgres:[PASSWORD]@[HOST]:[PORT]/postgres
   ```

### æ¸¬è©¦æ¡ˆä¾‹æ¸…å–®

| ç·¨è™Ÿ | æ¸¬è©¦é …ç›® | æ¸¬è©¦æ­¥é©Ÿ | é æœŸçµæœ |
|------|---------|---------|---------|
| T01 | é€é Python å»ºè¡¨ | åŸ·è¡Œ `python create_tables.py` | çµ‚ç«¯æ©Ÿé¡¯ç¤ºæˆåŠŸè¨Šæ¯ï¼ŒSupabase Dashboard å‡ºç¾ 4 å€‹è³‡æ–™è¡¨ |
| T02 | å”¯ä¸€ç´„æŸæ¸¬è©¦ | å˜—è©¦ç”¨ç›¸åŒ Email å»ºç«‹ User | Python æ‹‹å‡º IntegrityError |
| T03 | é—œè¯æ€§æ¸¬è©¦ | å»ºç«‹ Order æ™‚å¸¶å…¥ user_id | æˆåŠŸå»ºç«‹ä¸¦èƒ½é€é ORM æŸ¥è©¢ user.orders |
| T04 | ç´šè¯åˆªé™¤ | åˆªé™¤ Order ç‰©ä»¶ | è³‡æ–™åº«ä¸­çš„ order_items è‡ªå‹•è¢«åˆªé™¤ |
| T05 | è³‡æ–™å‹åˆ¥é©—è­‰ | å¯«å…¥éŒ¯èª¤å‹åˆ¥è³‡æ–™ (å¦‚ quantity="abc") | Python æ‹‹å‡º DataError æˆ– ValidationError |
| T06 | é è¨­å€¼æª¢æŸ¥ | å»ºç«‹ User ä¸çµ¦ role | è³‡æ–™åº«è©²æ¬„ä½è‡ªå‹•å¡«å…¥ 'customer' |

### ç•°å¸¸æƒ…æ³è™•ç†

| ç•°å¸¸æƒ…æ³ | é æœŸç³»çµ±åæ‡‰ |
|---------|-------------|
| è³‡æ–™é¡å‹éŒ¯èª¤ | é¡¯ç¤ºé¡å‹è½‰æ›éŒ¯èª¤ |
| è¶…å‡ºæ¬„ä½é•·åº¦ | é¡¯ç¤ºè³‡æ–™æˆªæ–·è­¦å‘Š |
| é€£ç·šæ•¸éå¤š | Supabase é™åˆ¶æç¤º |
