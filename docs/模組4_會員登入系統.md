# 📦 模組4: 會員登入系統

## 1️⃣ 第一性原理拆解

**核心知識點：身份驗證 (Authentication)**

```
最根本的問題：
「怎麼證明你是你？」

生活類比：
├─ 進公司刷門禁卡 → 卡片 = 身份證明
├─ 銀行提款輸入密碼 → 密碼 = 秘密資訊
└─ 手機指紋解鎖 → 生物特徵 = 唯一識別

軟體中的實現：
帳號 + 密碼 = 數位身份證明
```

**拆解成3個子問題：**
1. **註冊**：「怎麼讓新人加入？」
2. **登入**：「怎麼確認是本人？」
3. **保持狀態**：「怎麼讓他不用一直登入？」

---

## 2️⃣ 模組設計

### 設計目標
提供安全的身份驗證機制，區分客戶和管理員權限。

### 核心功能
| 功能 | 說明 |
|------|------|
| 註冊 | 新用戶建立帳號，驗證資料格式 |
| 登入 | 驗證帳號密碼，發放 JWT Token |
| 登出 | 清除登入狀態 |
| 權限判定 | 區分 Customer/Admin/Super Admin |

### 資料結構

```sql
使用者表 (users)
├─ id (UUID, 主鍵)
├─ username (文字, 唯一)
├─ password_hash (文字, bcrypt 加密)
├─ email (文字, 唯一)
├─ role (文字: customer/admin/super_admin)
└─ created_at (時間戳記)
```

### 驗證規則

| 欄位 | 規則 |
|------|------|
| 帳號 | 4-20字元，只能英文數字 |
| 密碼 | 至少8字元，要有英文+數字 |
| Email | 符合 email 格式 |

### 安全機制
- 密碼使用 bcrypt 加密存儲
- 登入狀態使用 JWT Token（有效期7天）
- 連續登入失敗3次鎖定帳號30分鐘

### 可維護性設計

| 維度 | 設計要點 |
|------|---------|
| **模組化** | 驗證邏輯集中在 `auth/` 目錄 |
| **擴展性** | 預留「登入方式」抽象層（未來可加 Google/Line 登入） |
| **可讀性** | 清楚的函式命名與註解 |

---

## 3️⃣ AI 協作開發提示詞

### 完整 Prompt 範本

```markdown
# 會員登入系統需求

## 背景說明
我正在做一個訂單管理系統，需要區分「客戶」和「管理員」兩種身份。

## 功能需求

### 註冊功能
**使用者角色**：新客戶
**流程**：
1. 填寫註冊表單（帳號、密碼、email、公司名稱）
2. 系統檢查帳號是否已被使用
3. 如果可用 → 建立帳號，寄送歡迎信
4. 如果已存在 → 顯示「帳號已被使用，請換一個」

**驗證規則**：
- 帳號：4-20字元，只能英文數字
- 密碼：至少8個字元，要有英文+數字
- Email：要符合email格式

### 登入功能
**使用者角色**：已註冊客戶
**流程**：
1. 輸入帳號密碼
2. 系統檢查資料庫
3. 如果正確 → 記住登入狀態，導向首頁
4. 如果錯誤 → 顯示「帳號或密碼錯誤」
5. 如果連錯3次 → 鎖定帳號30分鐘

### 登出功能
**流程**：
清除登入狀態，導回登入頁面

## 技術需求
- 資料庫：使用 Supabase
- 密碼處理：需要加密（不要明文存）
- 登入狀態：保持7天（除非主動登出）

## 介面需求
- 簡潔的登入畫面（不要太花俏）
- 錯誤訊息要清楚明確
- 手機版也要能用

## 開發限制與指示
- 請不要進行任何自動化測試代碼的撰寫

請幫我生成這個會員系統的程式碼。
```

### Prompt 設計技巧

| ❌ 不好的 Prompt | ✅ 好的 Prompt |
|-----------------|---------------|
| 「幫我做會員登入」 | 包含背景、功能需求、驗證規則、技術需求、介面需求 |
| 太模糊，AI不知道要做什麼 | 結構化且具體，AI能精確實現 |

### 迭代改進範例

```
問題發現：「註冊時系統沒有檢查密碼強度」

追加 Prompt：
「我發現密碼沒有被檢查，請加上驗證：
 至少8個字元，要包含英文和數字」
```

---

## 4️⃣ 手動功能測試說明

### 測試環境準備
1. 確認 Supabase 資料庫已連線
2. 啟動後端 API 服務 (`python main.py`)
3. 開啟前端登入頁面

### 測試案例清單

| 編號 | 測試項目 | 測試步驟 | 預期結果 |
|------|---------|---------|---------|
| T01 | 註冊新帳號 | 輸入 user001/Pass1234/test@email.com | 註冊成功，顯示歡迎訊息 |
| T02 | 重複帳號註冊 | 再次輸入 user001 | 顯示「帳號已被使用」 |
| T03 | 弱密碼註冊 | 輸入密碼 123 | 顯示「密碼需至少8字元」 |
| T04 | 正確登入 | 用 user001/Pass1234 登入 | 成功進入系統首頁 |
| T05 | 錯誤密碼登入 | 輸入錯誤密碼3次 | 帳號鎖定30分鐘 |
| T06 | 登出功能 | 點擊登出按鈕 | 返回登入頁面 |
| T07 | Token 過期 | 超過7天未操作 | 需重新登入 |

### 異常情況處理

| 異常情況 | 預期系統反應 |
|---------|-------------|
| 資料庫連線失敗 | 顯示「系統維護中，請稍後再試」 |
| Email 格式錯誤 | 顯示「請輸入有效的 Email 地址」 |
| 網路逾時 | 顯示「連線逾時，請檢查網路」 |
