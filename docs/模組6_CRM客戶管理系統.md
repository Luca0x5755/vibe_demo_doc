# 📦 模組6: CRM 客戶管理系統

## 1️⃣ 第一性原理拆解

**核心知識點：業務邏輯設計 (Business Logic)**

```
最根本的問題：
「怎麼追蹤客戶的狀態，提供更好的服務？」

生活類比：
├─ 診所病歷：記錄就診歷史→了解病情
├─ 銀行客戶分級：VIP、一般客戶→不同服務
└─ 店員記熟客：這個客人喜歡什麼→客製服務

軟體中的實現：
客戶資料 + 互動紀錄 + 狀態追蹤 = CRM系統
```

**拆解成4個子問題：**
1. **客戶分類**：「怎麼把客戶分群？」
2. **互動記錄**：「要記錄哪些互動？」
3. **狀態追蹤**：「客戶處於銷售漏斗的哪個階段？」
4. **自動提醒**：「什麼時候該主動聯繫客戶？」

---

## 2️⃣ 模組設計

### 設計目標
追蹤客戶從「潛在客戶」到「忠誠客戶」的完整旅程，幫助業務團隊提供更好的服務。

### 客戶生命週期

```
┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐
│ 潛在   │ →  │ 初次   │ →  │ 活躍   │ →  │ 忠誠   │ →  │ 流失   │
│ 客戶   │    │ 購買   │    │ 客戶   │    │ 客戶   │    │ 客戶   │
│(Lead)  │    │(New)   │    │(Active)│    │(Loyal) │    │(Churn) │
└────────┘    └────────┘    └────────┘    └────────┘    └────────┘
    │             │             │             │             │
    ↓             ↓             ↓             ↓             ↓
詢價階段      首購階段      回購階段      VIP階段       未購買>6個月
```

### 資料結構

```
客戶檔案 (customers)
├─ 基本資料
│   ├─ 公司名稱、聯絡人、電話/Email、地址
├─ 分類標籤
│   ├─ 客戶等級：A/B/C 級
│   ├─ 產業別、客戶來源
├─ 銷售狀態
│   ├─ 目前階段、負責業務、下次聯繫日期
└─ 統計數據
    ├─ 累計訂單數、累計金額、最近訂單日期

互動紀錄 (interactions)
├─ 時間戳記、互動類型
├─ 內容摘要、下一步行動
└─ 記錄者
```

### 客戶等級評分規則

| 等級 | 條件（滿足任一） |
|------|-----------------|
| **A 級** | 累計訂單金額 > 50萬 / 訂單筆數 > 20筆 / 最近訂單在1個月內 |
| **B 級** | 累計訂單金額 10-50萬 / 訂單筆數 5-20筆 / 最近訂單在3個月內 |
| **C 級** | 其他 |

### 可維護性設計：規則引擎

**設計原則**：業務規則存在設定檔，不寫死在程式碼

```json
{
  "scoring_rules": {
    "A_level": {
      "min_amount": 500000,
      "min_orders": 20,
      "recent_days": 30
    },
    "B_level": {
      "min_amount": 100000,
      "min_orders": 5,
      "recent_days": 90
    }
  }
}
```

**好處**：未來改規則不用動程式碼

---

## 3️⃣ AI 協作開發提示詞

### 完整 Prompt 範本

```markdown
# CRM 客戶管理系統需求

## 系統目標
追蹤客戶從「潛在客戶」到「忠誠客戶」的完整旅程，幫助業務團隊提供更好的服務。

## 核心功能

### 1. 客戶檔案管理

**客戶列表頁**
- 顯示所有客戶，可依狀態篩選（潛在/新客/活躍/忠誠/流失）
- 顯示欄位：公司名稱、聯絡人、客戶等級、累計訂單、最近訂單日期
- 可依「最近訂單日期」排序，越久沒下單的排前面

**客戶詳情頁**
分成4個區塊：

**區塊1：基本資料卡**
- 公司名稱、聯絡人、電話、Email、地址
- 可編輯按鈕

**區塊2：客戶標籤**
- 客戶等級（A/B/C）用顏色標示（A=金色、B=銀色、C=灰色）
- 產業別、客戶來源
- 可新增自訂標籤

**區塊3：統計儀表板**
- 累計訂單數、累計金額、最近訂單日期
- 平均訂單金額
- 訂單趨勢圖（最近6個月）

**區塊4：訂單歷史**
- 列出所有訂單（可展開看明細）

### 2. 互動紀錄

**新增互動記錄**
- 選擇類型：電話、Email、拜訪、其他
- 時間（預設當前時間）
- 互動內容（文字框）
- 下一步行動、下次聯繫日期（選填）

**互動歷史時間軸**
- 按時間倒序顯示
- 不同類型用不同圖示

### 3. 待辦提醒

自動產生提醒：
- 「客戶X已經3個月沒下單，建議關懷」
- 「今天要聯繫客戶Y」
- 「客戶Z昨天下了大單，建議致謝」

### 4. 客戶等級自動評分

[貼上評分規則]

每天凌晨自動重新計算所有客戶等級。

## 技術需求
- 後端：Python + Supabase
- 前端：Lovable
- 自動評分：使用排程器每天執行

請幫我生成這個 CRM 系統的程式碼。
```

### 規則引擎 Prompt

```markdown
請建立一個 config.json 存放評分規則，程式碼從這個檔案讀取規則，
這樣未來改規則不用動程式碼
```

---

## 4️⃣ 手動功能測試說明

### 測試環境準備
1. 確認 Supabase 資料庫已連線
2. 準備測試客戶資料（含不同等級）
3. 啟動 CRM 介面

### 測試案例清單

| 編號 | 測試項目 | 測試步驟 | 預期結果 |
|------|---------|---------|---------|
| T01 | 客戶列表顯示 | 進入客戶列表頁 | 顯示所有客戶，含等級標示 |
| T02 | 篩選功能 | 選擇「流失客戶」 | 只顯示6個月未下單客戶 |
| T03 | 客戶詳情 | 點擊客戶名稱 | 顯示4個區塊的詳細資訊 |
| T04 | 新增互動記錄 | 填寫表單並儲存 | 時間軸出現新記錄 |
| T05 | 自動提醒 | 查看待辦列表 | 顯示關懷提醒 |
| T06 | 等級自動計算 | 模擬大額訂單後等待排程 | 客戶等級自動升級 |
| T07 | 規則修改 | 修改 config.json 後重啟 | 新規則生效 |  

### 異常情況處理

| 異常情況 | 預期系統反應 |
|---------|-------------|
| 客戶資料不完整 | 標示「資料待補」 |
| 排程執行失敗 | 記錄錯誤並通知管理員 |
| 標籤重複 | 提示「標籤已存在」 |
