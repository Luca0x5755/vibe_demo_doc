# 📦 模組6: CRM 客戶管理系統

## 1️⃣ 第一性原理拆解

**核心知識點：業務邏輯設計 (Business Logic)**

```
最根本的問題：
「怎麼追蹤客戶的狀態，提供更好的服務？」

生活類比：
├─ 診所病歷：記錄就診歷史→了解病情
├─ 銀行客戶分級：VIP、一般客戶→不同服務
└─ 店員記熟客：這個客人喜歡什麼→客製服務

軟體中的實現：
客戶資料 + 互動紀錄 + 狀態追蹤 = CRM系統
```

**拆解成4個子問題：**
1. **客戶分類**：「怎麼把客戶分群？」
2. **互動記錄**：「要記錄哪些互動？」
3. **狀態追蹤**：「客戶處於銷售漏斗的哪個階段？」
4. **自動提醒**：「什麼時候該主動聯繫客戶？」

---

## 2️⃣ 模組設計

### 設計目標
追蹤客戶從「潛在客戶」到「忠誠客戶」的完整旅程，幫助業務團隊提供更好的服務。

### 客戶生命週期

```
┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐
│ 潛在   │ →  │ 初次   │ →  │ 活躍   │ →  │ 忠誠   │ →  │ 流失   │
│ 客戶   │    │ 購買   │    │ 客戶   │    │ 客戶   │    │ 客戶   │
│(Lead)  │    │(New)   │    │(Active)│    │(Loyal) │    │(Churn) │
└────────┘    └────────┘    └────────┘    └────────┘    └────────┘
    │             │             │             │             │
    ↓             ↓             ↓             ↓             ↓
詢價階段      首購階段      回購階段      VIP階段       未購買>6個月
```

### 資料結構

```
客戶檔案 (customers)
├─ 基本資料
│   ├─ 公司名稱、聯絡人、電話/Email、地址
├─ 分類標籤
│   ├─ 客戶等級：A/B/C 級
│   ├─ 產業別、客戶來源
├─ 銷售狀態
│   ├─ 目前階段、負責業務、下次聯繫日期
└─ 統計數據
    ├─ 累計訂單數、累計金額、最近訂單日期

互動紀錄 (interactions)
├─ 時間戳記、互動類型
├─ 內容摘要、下一步行動
└─ 記錄者
```

### 客戶等級評分規則

| 等級 | 條件（滿足任一） |
|------|-----------------|
| **A 級** | 累計訂單金額 > 50萬 / 訂單筆數 > 20筆 / 最近訂單在1個月內 |
| **B 級** | 累計訂單金額 10-50萬 / 訂單筆數 5-20筆 / 最近訂單在3個月內 |
| **C 級** | 其他 |

### 可維護性設計：規則引擎

**設計原則**：業務規則存在設定檔，不寫死在程式碼

```json
{
  "scoring_rules": {
    "A_level": {
      "min_amount": 500000,
      "min_orders": 20,
      "recent_days": 30
    },
    "B_level": {
      "min_amount": 100000,
      "min_orders": 5,
      "recent_days": 90
    }
  }
}
```

**好處**：未來改規則不用動程式碼

---

## 3️⃣ AI 協作開發提示詞

### 後端 Prompt (Backend)

```markdown
# CRM 客戶管理系統 - 後端需求

## 系統目標
建立 CRM 系統的核心邏輯與資料存取層，支援客戶生命週期管理與自動化分級。

## 核心功能需求

### 1. 資料庫模型 (Schema)
使用 Supabase 建立以下資料表：
- **customers (客戶檔案)**：
  - 基本資料 (公司、聯絡人、電話/Email、地址)
  - 分類 (等級 A/B/C、產業、來源)
  - 統計 (累計訂單數、累計金額、最近訂單日期)
- **interactions (互動紀錄)**：
  - 欄位：時間戳記、類型 (電話/Email/拜訪)、內容摘要、下一步行動、記錄者

### 2. 核心 API
- **客戶管理**：
  - 列表 API：支援依狀態篩選、依「最近訂單日期」排序。
  - CRUD：新增、修改、查詢客戶詳情。
- **互動紀錄**：
  - 新增互動 API。
  - 歷史查詢 API：依時間倒序回傳。
- **待辦提醒**：
  - 邏輯檢測 API：回傳需提醒的事項 (如：久未下單、需聯繫)。

### 3. 客戶等級自動評分 (規則引擎)
- **配置化規則 (Rule Engine)**：
  - 請建立一個 `config.json` 存放評分規則 (例如：A級需累計金額 > 50萬)，**不要將規則寫死在程式碼中**。
  - 目的：未來業務調整規則時，只需修改 Config 檔即可生效。
- **手動觸發**：
  - 實作手動觸發 API，讀取 `config.json` 規則，重新計算並更新所有客戶的等級。


## 技術堆疊
- 後端：Python + Supabase
```

### 前端 Prompt (Frontend)

```markdown
# CRM 客戶管理系統 - 前端需求

## 系統目標
打造資訊豐富且易於操作的 CRM 儀表板，幫助業務快速掌握客戶狀態。

## UI/UX 介面需求

### 1. 客戶列表頁
- **列表呈現**：顯示公司名稱、聯絡人、當前等級。
- **篩選排序**：
  - 篩選器：狀態 (潛在/新客/活躍/忠誠/流失)。
  - 排序：將「越久沒下單」或「最近有互動」的客戶排在前面。

### 2. 客戶詳情頁 (Dashboard 佈局)
請採用 4 個區塊設計：

**區塊1：基本資料卡**
- 顯示聯絡資訊，提供「編輯」按鈕修改資料。

**區塊2：客戶標籤 (視覺化重點)**
- **等級標示**：使用鮮明顏色區分 (A級=金色, B級=銀色, C級=灰色)。
- 顯示產業別與客戶來源標籤。

**區塊3：統計儀表板**
- 數據卡片：累計訂單數、累計金額、最近訂單日期。
- 圖表：顯示最近 6 個月的訂單金額趨勢圖。

**區塊4：訂單與互動區**
- **訂單歷史**：折疊式列表，可查看過往訂單。
- **互動時間軸**：
  - 視覺化 Timeline，倒序顯示。
  - 不同互動類型 (電話/Email) 顯示對應 Icon。
  - 提供「新增互動」表單 (含類型、內容、下一步)。

### 3. 待辦提醒
- 在顯眼處 (如 Sidebar 或頂部) 顯示系統生成的提醒通知 (如：客戶 X 需關懷)。

## 技術堆疊
- 前端框架：Lovable (React/TypeScript)
- 視覺風格：現代化、清晰、資訊分層明確。
```

---

## 4️⃣ 手動功能測試說明

### 測試環境準備
1. 確認 Supabase 資料庫已連線
2. 準備測試客戶資料（含不同等級）
3. 啟動 CRM 介面

### 測試案例清單

| 編號 | 測試項目 | 測試步驟 | 預期結果 |
|------|---------|---------|---------|
| T01 | 客戶列表顯示 | 進入客戶列表頁 | 顯示所有客戶，含等級標示 |
| T02 | 篩選功能 | 選擇「流失客戶」 | 只顯示6個月未下單客戶 |
| T03 | 客戶詳情 | 點擊客戶名稱 | 顯示4個區塊的詳細資訊 |
| T04 | 新增互動記錄 | 填寫表單並儲存 | 時間軸出現新記錄 |
| T05 | 自動提醒 | 查看待辦列表 | 顯示關懷提醒 |
| T06 | 等級自動計算 | 模擬大額訂單後手動觸發計算 | 客戶等級自動升級 |

| T07 | 規則修改 | 修改 config.json 後重啟 | 新規則生效 |  

### 異常情況處理

| 異常情況 | 預期系統反應 |
|---------|-------------|
| 客戶資料不完整 | 標示「資料待補」 |


| 標籤重複 | 提示「標籤已存在」 |
